// IMPORTANT: Bu dosyayı manuel olarak App.jsx'e entegre etmeniz gerekiyor
// IflasOCRInterface() fonksiyonunu bu içerikle değiştirin

// NOT: Dosyada zaten eklenen state'ler var:
// - const [activeTab, setActiveTab] = useState('image')
// - Excel batch states

// AŞAĞIDAKİ FONKSİYONLARI handleProcess() fonksiyonundan SONRAekleyin:

    // Excel batch handlers
    const handleExcelChange = (e) => {
        const file = e.target.files[0]
        if (file) {
            setExcelFile(file)
            setExcelResults(null)
            setExcelError(null)
        }
    }

    const handleExcelProcess = async () => {
        if (!excelFile) return
        if (!apiKey || apiKey.trim() === '') {
            setExcelError('Lütfen OpenAI API Key giriniz')
            return
        }

        setExcelLoading(true)
        setExcelError(null)

        const formData = new FormData()
        formData.append('file', excelFile)
        formData.append('openai_api_key', apiKey)
        formData.append('id_column', 'A')

        try {
            const response = await fetch('/api/v1/pipelines/iflas-ocr-batch', {
                method: 'POST',
                body: formData,
            })

            const data = await response.json()

            if (!response.ok) {
                throw new Error(data.detail || 'İşlem başarısız oldu')
            }

            setExcelResults(data)
        } catch (err) {
            setExcelError(err.message)
        } finally {
            setExcelLoading(false)
        }
    }

    // Excel export function
    const exportToExcel = () => {
        if (!excelResults || !excelResults.results) return

        const headers = [
            'Satır No', 'Clip ID', 'Durum', 'Ad/Soyad/Ünvan', 'TCKN', 'VKN',
            'Adres', 'İcra/İflas Müdürlüğü', 'Dosya Yılı', 'İlan Türü',
            'İlan Tarihi', 'Davacılar', 'Ham OCR Metni', 'Hata'
        ]

        const rows = excelResults.results.map(result => [
            result.row,
            result.clip_id,
            result.status === 'success' ? 'Başarılı' : 'Hata',
            result.data?.ad_soyad_unvan || '',
            result.data?.tckn || '',
            result.data?.vkn || '',
            result.data?.adres || '',
            result.data?.icra_iflas_mudurlugu || '',
            result.data?.dosya_yili || '',
            result.data?.ilan_turu || '',
            result.data?.ilan_tarihi || '',
            result.data?.davacilar?.join(', ') || '',
            result.raw_ocr_text || '',
            result.error || ''
        ])

        const csvContent = [
            headers.join(','),
            ...rows.map(row => row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(','))
        ].join('\n')

        const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' })
        const link = document.createElement('a')
        link.href = URL.createObjectURL(blob)
        link.download = `iflas_ocr_sonuclari_${new Date().toISOString().split('T')[0]}.csv`
        link.click()
    }

// ========================================
// RETURN STATEMENT'DA DEĞİŞİKLİKLER
// ========================================

// İlk div'den sonra (başlık div'inden sonra) şu tab selector'ı ekleyin:

            {/* Tab Selector */}
            <div style={{ marginBottom: '2rem', display: 'flex', gap: '1rem', borderBottom: '2px solid var(--border-color)' }}>
                <button
                    className={`btn ${activeTab === 'image' ? 'btn-primary' : 'btn-secondary'}`}
                    onClick={() => setActiveTab('image')}
                    style={{ 
                        borderRadius: '0.5rem 0.5rem 0 0',
                        borderBottom: activeTab === 'image' ? '2px solid #f59e0b' : 'none',
                        marginBottom: '-2px'
                    }}
                >
                    <Upload size={18} /> Görsel Yükleme
                </button>
                <button
                    className={`btn ${activeTab === 'excel' ? 'btn-primary' : 'btn-secondary'}`}
                    onClick={() => setActiveTab('excel')}
                    style={{ 
                        borderRadius: '0.5rem 0.5rem 0 0',
                        borderBottom: activeTab === 'excel' ? '2px solid #f59e0b' : 'none',
                        marginBottom: '-2px'
                    }}
                >
                    <FileText size={18} /> Excel Toplu İşleme
                </button>
            </div>

// Mevcut <div style={{ display: 'grid'... kısmını şununla SARIN:

            {/* Image Upload Tab */}
            {activeTab === 'image' && (
                // ... mevcut grid div ve içeriği buraya ...
            )}

            {/* Excel Batch Tab */}
            {activeTab === 'excel' && (
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '2rem' }}>
                    {/* Left Column */}
                    <div>
                        <div className="glass-panel" style={{ padding: '1.5rem', marginBottom: '1.5rem' }}>
                            <label style={{ display: 'block', marginBottom: '0.5rem', fontWeight: 600, color: '#f59e0b' }}>
                                OpenAI API Key *
                            </label>
                            <input
                                type="password"
                                value={apiKey}
                                onChange={(e) => setApiKey(e.target.value)}
                                placeholder="sk-proj-..."
                                style={{
                                    width: '100%',
                                    padding: '0.75rem',
                                    background: 'var(--bg-color)',
                                    border: '1px solid var(--border-color)',
                                    borderRadius: '0.5rem',
                                    color: 'var(--text-primary)',
                                    fontSize: '0.9rem'
                                }}
                            />
                        </div>

                        <div className="glass-panel" style={{ padding: '2rem', textAlign: 'center', cursor: 'pointer', marginBottom: '1.5rem' }}
                            onClick={() => excelInputRef.current?.click()}
                        >
                            <input
                                type="file"
                                ref={excelInputRef}
                                onChange={handleExcelChange}
                                accept=".xlsx,.xls"
                                style={{ display: 'none' }}
                            />

                            {excelFile ? (
                                <div>
                                    <FileText size={48} color="#10b981" style={{ margin: '0 auto 1rem' }} />
                                    <h3 style={{ fontSize: '1.1rem', fontWeight: 600 }}>{excelFile.name}</h3>
                                    <p style={{ color: 'var(--text-secondary)', fontSize: '0.9rem' }}>Dosya yüklendi</p>
                                </div>
                            ) : (
                                <>
                                    <FileText size={48} color="#f59e0b" style={{ margin: '0 auto 1rem' }} />
                                    <h3 style={{ fontSize: '1.1rem', fontWeight: 600 }}>Excel dosyası yükleyin</h3>
                                    <p style={{ color: 'var(--text-secondary)', fontSize: '0.9rem' }}>İlk kolondan clip ID'leri okunacak</p>
                                </>
                            )}
                        </div>

                        <button
                            className="btn btn-primary"
                            style={{ width: '100%', marginBottom: '1rem' }}
                            disabled={!excelFile || excelLoading || !apiKey}
                            onClick={handleExcelProcess}
                        >
                            {excelLoading ? <><Loader2 className="loading-spinner" size={20} /> İşleniyor...</> : 'Toplu İşle'}
                        </button>

                        {excelResults && (
                            <button
                                className="btn btn-secondary"
                                style={{ width: '100%', background: '#10b981', color: 'white' }}
                                onClick={exportToExcel}
                            >
                                <FileText size={18} /> Excel Olarak İndir
                            </button>
                        )}
                    </div>

                    {/* Right Column - Results */}
                    <div className="glass-panel" style={{ padding: '2rem', maxHeight: '800px', overflowY: 'auto' }}>
                        <h3 style={{ fontSize: '1.25rem', fontWeight: 600, marginBottom: '1.5rem' }}>Sonuçlar</h3>
                        
                        {excelLoading && (
                            <div style={{ textAlign: 'center', padding: '3rem', color: 'var(--text-secondary)' }}>
                                <Loader2 className="loading-spinner" size={32} />
                                <p style={{ marginTop: '1rem' }}>Clip'ler işleniyor...</p>
                            </div>
                        )}

                        {excelError && (
                            <div style={{ color: '#ef4444', display: 'flex', alignItems: 'center', gap: '0.5rem', padding: '1rem', background: 'rgba(239, 68, 68, 0.1)', borderRadius: '0.5rem' }}>
                                <AlertCircle size={20} />
                                {excelError}
                            </div>
                        )}

                        {excelResults && (
                            <div>
                                {/* Summary */}
                                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '1rem', marginBottom: '2rem' }}>
                                    <div style={{ background: 'rgba(99, 102, 241, 0.1)', padding: '1rem', borderRadius: '0.5rem', textAlign: 'center' }}>
                                        <div style={{ fontSize: '1.5rem', fontWeight: 700, color: '#6366f1' }}>{excelResults.total}</div>
                                        <div style={{ fontSize: '0.8rem', color: 'var(--text-secondary)' }}>Toplam</div>
                                    </div>
                                    <div style={{ background: 'rgba(16, 185, 129, 0.1)', padding: '1rem', borderRadius: '0.5rem', textAlign: 'center' }}>
                                        <div style={{ fontSize: '1.5rem', fontWeight: 700, color: '#10b981' }}>{excelResults.successful}</div>
                                        <div style={{ fontSize: '0.8rem', color: 'var(--text-secondary)' }}>Başarılı</div>
                                    </div>
                                    <div style={{ background: 'rgba(239, 68, 68, 0.1)', padding: '1rem', borderRadius: '0.5rem', textAlign: 'center' }}>
                                        <div style={{ fontSize: '1.5rem', fontWeight: 700, color: '#ef4444' }}>{excelResults.failed}</div>
                                        <div style={{ fontSize: '0.8rem', color: 'var(--text-secondary)' }}>Hata</div>
                                    </div>
                                    <div style={{ background: 'rgba(245, 158, 11, 0.1)', padding: '1rem', borderRadius: '0.5rem', textAlign: 'center' }}>
                                        <div style={{ fontSize: '1.5rem', fontWeight: 700, color: '#f59e0b' }}>{excelResults.processed}</div>
                                        <div style={{ fontSize: '0.8rem', color: 'var(--text-secondary)' }}>İşlenen</div>
                                    </div>
                                </div>

                                {/* Results Preview */}
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                                    {excelResults.results.slice(0, 10).map((result, idx) => (
                                        <div key={idx} style={{ 
                                            background: result.status === 'success' ? 'rgba(16, 185, 129, 0.05)' : 'rgba(239, 68, 68, 0.05)', 
                                            borderRadius: '0.5rem', 
                                            padding: '1rem', 
                                            border: `1px solid ${result.status === 'success' ? 'rgba(16, 185, 129, 0.2)' : 'rgba(239, 68, 68, 0.2)'}`
                                        }}>
                                            <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '0.5rem' }}>
                                                <span style={{ fontWeight: 600 }}>#{result.row} - {result.clip_id}</span>
                                                <span style={{ 
                                                    padding: '0.25rem 0.5rem', 
                                                    borderRadius: '0.25rem', 
                                                    fontSize: '0.75rem', 
                                                    background: result.status === 'success' ? '#10b981' : '#ef4444',
                                                    color: 'white'
                                                }}>
                                                    {result.status === 'success' ? 'Başarılı' : 'Hata'}
                                                </span>
                                            </div>
                                            {result.status === 'success' ? (
                                                <div style={{ fontSize: '0.85rem', color: 'var(--text-secondary)' }}>
                                                    {result.data?.ad_soyad_unvan && <div>• {result.data.ad_soyad_unvan}</div>}
                                                    {result.data?.ilan_turu && <div>• {result.data.ilan_turu}</div>}
                                                </div>
                                            ) : (
                                                <div style={{ fontSize: '0.85rem', color: '#ef4444' }}>
                                                    {result.error}
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                    {excelResults.results.length > 10 && (
                                        <div style={{ textAlign: 'center', color: 'var(--text-secondary)', fontSize: '0.9rem' }}>
                                            ... ve {excelResults.results.length - 10} sonuç daha (Excel'i indirin)
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            )}
