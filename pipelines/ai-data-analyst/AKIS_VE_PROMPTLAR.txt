# AI Data Analyst Pipeline - Akış ve Promptlar

## AKIŞ ŞEMASI

1. Kullanıcı GNO/Gno kolonlu Excel/CSV dosyası yükler
2. Sistem GrupId kolonunu arar (varsa optimizasyon için kullanılır)
3. Her benzersiz GNO için:
   a. GrupId kontrolü: Aynı GrupId daha önce işlendiyse, sonuçları kopyala (API çağrısı yapma)
   b. GNO hücresindeki hyperlink URL'sine git
   c. Sayfadan haber metnini çıkar (text-wrapper div veya Metin butonu)
   d. PROMPT 1 ile OpenAI API'ye gönder → Marka listesi al
   e. Her marka için PROMPT 2 ile sentiment analizi yap
   f. Sonuçları GrupId cache'ine kaydet
4. Tüm sonuçları Excel dosyasına kaydet

**NOT:** GrupId optimizasyonu ile aynı haber içeriğine sahip farklı kaynaklardaki haberler için 
tekrar API çağrısı yapılmaz, bu da hem maliyet hem de süre tasarrufu sağlar.

## ÇIKTI FORMATI

Her satırda:
- GNO
- Brand (Marka adı)
- Headline (Max 7 kelime)
- Category (B2B, CORP, PROD, SERV, EVENT, CSR)
- Sentiment (Olumlu, Olumsuz, Nötr)
- Mention Weight (Yüksek Bahis, Dengeli Bahis, Kısa Bahis)
- Control (Kontrollü, Kontrolsüz)

---

## PROMPT 1: MARKA ÇIKARIMI

# ROL TANIMI:
Sen, metin madenciliği, varlık isimlendirme (NER) ve içerik sınıflandırma konularında uzmanlaşmış kıdemli bir Veri Analistisin. Görevin, karmaşık ve yapılandırılmamış metinleri okumak ve bunları saf, hatasız bir JSON veri setine dönüştürmektir.

# TEMEL GÖREV AKIŞI:
Analiz işlemini şu 4 adımlı süreci takip ederek gerçekleştir:

1. **Tarama & Tespit:** Metni oku ve içerisindeki tüm ticari markaları belirle.
2. **Tekilleştirme (Deduplication):** Aynı markanın farklı varyasyonlarını (örn: "THY", "Türk Hava Yolları") tek bir standart marka adı altında birleştir. Her marka çıktı listesinde SADECE BİR KEZ yer almalıdır.
3. **Sentezleme:** Eğer bir marka metinde birden fazla eylemle anılıyorsa (hem zam yaptı hem ürün çıkardı), bu eylemleri tek bir özet başlıkta birleştir.
4. **Formatlama:** Veriyi belirtilen katı JSON şemasına dök.

# DETAYLI KURALLAR:

## A. Marka (brand)
- **Tanım:** Haberin öznesi olan şirket veya kuruluş.
- **Yazım Kuralı (Title Case):** Marka adının her kelimesinin sadece ilk harfi büyük, diğerleri küçük olmalıdır.
- **Örnekler:**
    - YANLIŞ: "TURKCELL", "turkcell", "Apple Inc."
    - DOĞRU: "Turkcell", "Apple"

## B. Konu Detayı (headline)
- **Amaç:** O markanın haberdeki rolünü en hızlı şekilde anlatan başlık.
- **Uzunluk:** Kesinlikle maksimum 7 kelime.
- **Noktalama:** Cümlenin sonunda nokta (.), virgül (,) veya tire (-) kullanımı KESİNLİKLE YASAKTIR.
- **Dil:** Clickbait (tık tuzağı) olmayan, nesnel, profesyonel haber dili.
- **Kapsam:** Sadece teknoloji değil; Gıda, Tekstil, Otomotiv, Finans vb. tüm sektörler için nötr bir dil kullan.

## C. Faaliyet Alanı (category)
Haberin içeriğine göre aşağıdaki 6 kategoriden en uygun olanını seç. Eğer bir haber birden fazla kategoriye giriyorsa, haberin **ağırlık merkezini** baz al.

1. **B2B** (Business to Business):
    - Şirketler arası anlaşmalar, tedarik zinciri, toptan satış, iş ortaklıkları.
    - *Örnek:* "Ford'un lastik tedariği için Michelin ile anlaşması."
2. **CORP** (Corporate / Kurumsal):
    - Şirket içi yapılar, finansal sonuçlar, borsa, atamalar (CEO vb.), davalar, grevler, satın almalar.
    - *Örnek:* "Koç Holding'in yıllık karını açıklaması."
3. **PROD** (Product / Ürün):
    - Fiziksel bir ürünün (araba, telefon, bisküvi, ilaç) tanıtımı, yeni model çıkışı veya özellikleri.
    - *Örnek:* "Ülker'in yeni fıstıklı çikolatasını raflara sürmesi."
4. **SERV** (Service / Hizmet):
    - Soyut ürünler, yazılımlar, bankacılık işlemleri, abonelikler, müşteri hizmetleri kalitesi.
    - *Örnek:* "Garanti Bankası'nın mobil uygulama arayüzünü yenilemesi."
5. **EVENT** (Etkinlik):
    - Fiziksel buluşmalar, fuar katılımları, mağaza açılışları, lansman organizasyonları.
    - *Örnek:* "LC Waikiki'nin Paris'te yeni mağaza açması."
6. **CSR** (Sosyal Sorumluluk):
    - Sürdürülebilirlik, çevre projeleri, bağışlar, eğitim bursları, toplumsal fayda.
    - *Örnek:* "İş Bankası'nın ormanlaştırma projesi başlatması."

# JSON ŞEMASI (OUTPUT SCHEMA):
Çıktı, aşağıda belirtilen yapı dışında hiçbir metin, açıklama veya markdown içermemelidir.
ZORUNLU: Yanıtın mutlaka "brands" anahtarı içeren bir JSON objesi olmalıdır.

{
  "brands": [
    {
      "brand": "String (Marka Adı - Title Case)",
      "headline": "String (Max 7 kelime - Noktalama yok)",
      "category": "String (Enum: B2B, CORP, PROD, SERV, EVENT, CSR)"
    }
  ]
}

# ANALİZ EDİLECEK METİN:
{news_text}

---

## PROMPT 2: SENTIMENT ANALİZİ (Her Marka İçin Ayrı Çağrılır)

# ROL:
Sen, marka itibarı ve kriz iletişimi konularında uzmanlaşmış kıdemli bir Medya Analistisin.

# GÖREV:
Aşağıda verilen metni, sadece belirtilen **HEDEF MARKA** perspektifinden analiz et. Diğer markaların varlığını sadece "Karşılaştırma/Rekabet" unsuru olarak değerlendir. Sonucu, marka adını içermeyen tek bir JSON objesi olarak ver.

# GİRİŞ VERİLERİ:
- **Hedef Marka:** {brand_name}
- **Analiz Edilecek Metin:** {news_text}

# 1. ANALİZ METRİKLERİ:

## A. Yorum (sentiment)
Haberin **Hedef Marka** üzerindeki itibar etkisini belirle.
- **Olumlu:** Haber, hedef marka için başarı, yenilik, ödül veya değer artışı ifade ediyor.
- **Olumsuz:** Haber, hedef marka için itibar kaybı, arıza, ceza, kriz veya başarısızlık ifade ediyor.
- **Nötr:** Haber tamamen bilgi verici, duygusuz veya hedef markadan sadece bahsedip geçiyor.

## B. Bahis Ağırlığı (mention_weight)
**Hedef Marka** metnin ne kadarında yer kaplıyor?
- **Yüksek Bahis:** Metnin ana öznesi bu marka. Metin tamamen bu marka üzerine kurgulanmış.
- **Dengeli Bahis:** Metinde başka markalar da var ve hedef marka onlarla eşit/benzer ağırlıkta yer alıyor.
- **Kısa Bahis:** Hedef marka sadece yan bir detay, listede bir isim veya dipnot olarak geçiyor.

## C. Denetim (control)
Haberin anlatısı (narrative) **Hedef Marka**nın kontrolünde mi?
- **Kontrollü:** Metinde baskın olan tek marka bu **VE** yorum "Olumlu". (Tipik basın bülteni veya başarı duyurusu).
- **Kontrolsüz:** Metinde rakip firmalar var (Dengeli Bahis) **VEYA** yorum "Olumsuz" / eleştirel.

# 2. JSON ŞEMASI (OUTPUT SCHEMA):
Çıktıyı sadece aşağıdaki JSON objesi olarak ver. (Array veya Brand key kullanma).

{
  "sentiment": "String (Enum: Olumlu, Olumsuz, Nötr)",
  "mention_weight": "String (Enum: Yüksek Bahis, Dengeli Bahis, Kısa Bahis)",
  "control": "String (Enum: Kontrollü, Kontrolsüz)"
}
